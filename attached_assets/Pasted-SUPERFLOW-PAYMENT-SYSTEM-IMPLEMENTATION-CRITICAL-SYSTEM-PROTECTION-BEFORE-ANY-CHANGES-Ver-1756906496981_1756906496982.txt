SUPERFLOW PAYMENT SYSTEM IMPLEMENTATION

üö® CRITICAL SYSTEM PROTECTION üö®
BEFORE ANY CHANGES: Verify these flows work perfectly:
1. superflow.work ‚Üí record ‚Üí transcribe ‚Üí results ‚Üí signup CTA
2. Dashboard ‚Üí authenticated user experience ‚Üí all existing features
3. Authentication: signup ‚Üí login ‚Üí logout ‚Üí session persistence

IF ANY CORE FLOW BREAKS AT ANY POINT: STOP, REVERT, FIX BEFORE CONTINUING.

üìä BUSINESS CONTEXT:
Superflow transforms 30s voice recordings into social content. Adding 3-tier premium system:
- LITE (‚Çπ199): 60 minutes total recording time, basic features
- PRO (‚Çπ999): 600 minutes + audio file uploads + advanced AI features  
- MAX (‚Çπ1999): Unlimited monthly usage + all premium features

üéØ IMPLEMENTATION GOAL:
Create payment system + premium subdomain (app.superflow.work) while preserving 100% free user experience.

‚ö° PHASE 1: PAYMENT FOUNDATION (Main App)
DATABASE SCHEMA UPDATES:
- EXTEND users table: ADD planType, minutesRemaining, planExpiresAt, isPremium
- CREATE payments table: id, userId, cashfreeOrderId, planType, amount, status, paidAt
- CREATE usage_tracking: id, userId, duration, remainingMinutes, timestamp

CASHFREE INTEGRATION:
- Install cashfree-pg package
- Configure sandbox mode with environment variables
- Return URL: "https://app.superflow.work/welcome"

API ENDPOINTS (ADD to routes.ts):
- POST /api/payments/create-order ‚Üí Cashfree order creation
- POST /api/payments/webhook ‚Üí Payment confirmation handler
- GET /api/user/plan-status ‚Üí Current subscription details

FRONTEND ADDITIONS:
- ADD pricing modal with 3 tiers (follow auth-modal.tsx pattern)
- ADD "Upgrade" buttons throughout free user journey
- ADD usage display for premium users (minutes remaining)

‚ö° PHASE 2: PREMIUM SUBDOMAIN APP
CREATE NEW REPLIT PROJECT for app.superflow.work:
- Copy core functionality from main app
- Same database connection string
- Enhanced recording interface (no 30s limit for premium)
- Audio file upload capability (Pro & Max only)
- Premium user verification on every page load

BUSINESS LOGIC:
- deductMinutes(userId, duration) on each recording
- Block recording when minutes exhausted (except Max unlimited)
- Auto-redirect premium users from main domain to subdomain
- Monthly reset for Max plan users

‚ö° PHASE 3: INTEGRATION & PRODUCTION
CROSS-DOMAIN USER FLOW:
- Main app login ‚Üí check isPremium ‚Üí if true, redirect to app.superflow.work
- Premium app ‚Üí verify subscription on load ‚Üí if expired, redirect to upgrade
- Shared session cookies (domain: .superflow.work)

FEATURE GATING BY PLAN:
- LITE: 60min recording, basic transcription, no uploads
- PRO: 600min recording, file uploads, advanced AI features
- MAX: Unlimited everything, priority processing

PRODUCTION SETUP:
- Switch Cashfree to production environment
- Configure DNS: app.superflow.work CNAME
- Test complete payment flow with real small amounts
- Robust error handling for payment failures

üîê SECURITY REQUIREMENTS:
- Store Cashfree credentials in environment variables
- Verify webhook signatures for payment confirmations
- Validate user permissions before premium feature access
- DPDP Act compliance for payment data handling

üì± USER EXPERIENCE:
FREE USER: superflow.work ‚Üí use 30s recordings ‚Üí see upgrade prompts ‚Üí payment ‚Üí redirect to app.superflow.work
PREMIUM USER: superflow.work login ‚Üí auto-redirect to app.superflow.work ‚Üí enhanced features

üíæ ENVIRONMENT VARIABLES NEEDED:
CASHFREE_CLIENT_ID_SANDBOX=your_sandbox_id
CASHFREE_CLIENT_SECRET_SANDBOX=your_sandbox_secret
CASHFREE_CLIENT_ID_PRODUCTION=your_production_id  
CASHFREE_CLIENT_SECRET_PRODUCTION=your_production_secret

‚úÖ SUCCESS CRITERIA:
- All existing free user flows work identically
- 3-tier payment system processes correctly in sandbox
- Premium subdomain verifies subscriptions and shows enhanced features
- Usage tracking deducts minutes accurately per plan
- Cross-domain authentication seamless
- Admin dashboard shows payment analytics
- Production-ready with error handling

‚è±Ô∏è EXECUTION ORDER:
1. Database schema + payment APIs (test via Postman)
2. Payment UI integration on main app
3. Create premium subdomain app with enhanced features
4. Perfect cross-domain user flow and production setup

üéØ FINAL DELIVERABLE:
Complete freemium-to-premium platform where:
- Free users: Unchanged experience with upgrade paths
- Paid users: Seamless premium app with usage-based features
- Business: Revenue-generating subscription system with analytics

CONFIRMATION REQUIRED: Reply "‚úÖ PAYMENT SYSTEM IMPLEMENTATION COMPLETE" only when all phases work perfectly and user journeys are seamless.
